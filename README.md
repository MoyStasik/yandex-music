# Яндекс музыка

## 1. Тема и целевая аудитория

### Тема

**Яндекс музыка** - музыкальный стриминговый сервис компании Яндекс, позволяющий слушать музыкальные композиции, их подборки, альбомы и получать персональные рекомендации. 

### Целевая аудитория
+ Количество уникальных пользователей за месяц: 24млн [2] *
+ Количество посещений приложения в месяц: 81.6 миллионов [1]
+ Среднее время пребывания пользователя на сайте: 3 минуты 56 секунд [1]
+ Среднее количество страниц за посещение: 2.58 [1]
+ Среднее количество посещений одного пользователя за месяц: 21 день
+ Среднестатистический пользователь слушает около 20-30 треков в день
+ 28% пользователей слушают подкасты хотя бы раз в месяц [3]

*- Данные за декабрь 2024 года


**Веб-трафик по странам**

![image](https://github.com/user-attachments/assets/28474299-8247-4df0-a4bc-13c64783e4a7)

**Демографические показатели посещаемости сайта**

![image](https://github.com/user-attachments/assets/cad65256-a375-4c5f-811c-ef3f374f86f8)

### Ключевой функционал
+ Регистрация/авторизация
+ Воспроизведение музыки
+ Добавление треков в плейлист, удаление из плейлиста, хранение плейлистов
+ Поиск исполнителя, трека, альбома
+ История прослушивания треков
+ Поиск музыки по жанру
+ прослушивание подкастов

### Ключевые продуктовые решения
+ Личные рекомендации под каждого пользователя
+ Выбор музыкального настроения, для воспроизведения соответствующей музыки

### Список используемых источников
1. [https://www.similarweb.com/ru/website/music.yandex.ru](https://www.similarweb.com/ru/website/music.yandex.ru)
2. [https://www.rbc.ru/technology_and_media/02/12/2024/674db2029a79474943d5748e](https://www.rbc.ru/technology_and_media/02/12/2024/674db2029a79474943d5748e)
3. [https://vc.ru/media/187539-auditoriya-podkastov-na-yandeksmuzyke-vyrosla-v-chetyre-raza-za-god-hotya-by-raz-v-mesyac-ih-slushayut-uzhe-28-podpischikov](https://vc.ru/media/187539-auditoriya-podkastov-na-yandeksmuzyke-vyrosla-v-chetyre-raza-za-god-hotya-by-raz-v-mesyac-ih-slushayut-uzhe-28-podpischikov)


## 2. Расчет нагрузки
### Продуктовые метрики
Таблица 1 - Количество активных пользователей
<table>
    <tr>
        <th>Период</th>
        <th>Количество пользователей</th>
    </tr>
    <tr>
        <td>День</td>
        <td>14,4 миллиона</td>
    </tr>
    <tr>
        <td>Месяц</td>
        <td>24 миллиона</td>
    </tr>
</table>

Таблица 2 - Средний размер хранилища пользователя
<table>
    <tr>
        <th>Тип хранилища</th>
        <th>Средний объем на 1 пользователя</th>
    </tr>
    <tr>
        <td>Плейлисты</td>
        <td>в среднем на пользователя 4 плейлиста, в среднем пользователи добавляют 1000 треков в плейлисты, 
          на 1 плейлист приходится около 250 треков, итого 1 плейлист состоит из обложки - размер фото около 3 МБ, название плейлиста - 30 байт, хранение одной песни в виде id и другой метаинформации занимает около 0.1Кб (данные из devtools). Итого: 4*(3МБ + 30 байт + 0,1Кбайт) + 1000*0,1Кбайт = 12,1МБ </td>
    </tr>
  <tr>
        <td>История прослушиваний</td>
        <td>За год пользователь в среднем слушает 3300 уникальных треков для хранения истории необходимо 0.1Кбайт метаифнормации для 1 трека. Итого:  3300 * 0,1Кбайт = 0,32МБ</td>
    </tr>
</table>

Таблица 3 - Действия пользователей по типам
<table>
    <tr>
        <th>Тип действия</th>
        <th>Среднее количество в день</th>
    </tr>
    <tr>
        <td>Воспроизведение музыки</td>
        <td>Среднестатистический пользователь прослушивает в день около 30 треков, так как всего в сутки 14,4 млн пользователей, то всего в день прослушивается 14,4 * 30 = 432 млн</td>
    </tr>
  <tr>
        <td>Авторизация</td>
        <td> 24 млн / 30 = 800 тыс</td>
    </tr>
    <tr>
        <td>Регистрация</td>
        <td> 12 тыс</td>
    </tr>
    <tr>
        <td>Добавление/удаление треков в/из плейлист</td>
        <td> 1,554 млн</td>
    </tr>
    <tr>
        <td>Прослушивание треков из истории</td>
        <td> В среднем пользователь 1 раз включает трек из истории прослушиваний, всего в сутки 14,4млн юзеров, тогда всего обращений к истории треков - 14,4 * 1 = 14,4 млн </td>
    </tr>
    <tr>
        <td>Поиск исполнителя, трека, альбома</td>
        <td> Среднее количество поисков за день - 57,6 млн</td>
    </tr>
    <tr>
        <td>Поиск треков по жанру</td>
        <td> 140 тыс </td>
    </tr>
    <tr>
        <td>Прослушивание подкастов</td>
        <td>в день 7% пользователей слушают подкасты, 14,4 * 0,07 = 1,008 млн[2]</td>
    </tr>
</table>

### Технические метрики
В среднем размер треков с битрейтом 128Кбит/c будет около 7МБ и обложка/картинка 3МБ, итого 10МБ.[1]

В среднем подкасты длятся около 30 мин и занимают около 70 МБ памяти + 3МБ на обложку.

Таблица 4 - Размер хранения в разбивке по типам данных
<table>
    <tr>
        <th>Тип хранения</th>
        <th>Размер</th>
    </tr>
    <tr>
        <td>Пользователи</td>
        <td>из таблицы 2, на одного пользователя необходимо (12,1 + 0,32) = 12,42 МБ, тогда на 24 млн пользователей, 284ТБ</td>
    </tr>
    <tr>
        <td>Треки</td>
        <td>на 1 трек 10 МБ, всего 76 млнов треков, тогда для хранения всех понадобится 724,8ТБ[5]</td>
    </tr>
    <tr>
        <td>Подкасты</td>
        <td>В Яндекс музыке около 25,9тыс подкастов, тогда все подкасты будут занимать около 1,8ТБ[4]</td>
    </tr>
</table>

Битрейт песен возьмем - 128 Кбит/c.[3]

Таблица 5 - Сетевые метрики
<table>
    <tr>
        <th>Тип действия</th>
        <th>Пиковое потребление в течение суток, Гбит/с</th>
        <th>Суммарный суточный, Гбайт/сутки</th>
        <th>RPS (средний)</th>
        <th>RPS (пиковый)</th>
    </tr>
    <tr>
        <td>Воспроизведение музыки</td>
        <td>120 000 * 128Кбит/с = 15 360 000Кбит/c = 144,23</td>
        <td>14,4млн * 60мин * 60с * 128 Кбит/c / 2^20 = 6 328 125</td>
        <td>Всего 14,4 млн юзеров, тк в сутки примерно 60 минут средний пользователь слушает музыку, и запрос на новый чанк случается раз в ~ 10 секунд, те ~ 6 раз в минуту, то средний рпс будет, rps = 14,4млн * 60мин * 6 / 86400с = 60 000</td>
        <td>В пик около 120тыс пользователей слушает музыку одновременно, rps = 120 000 </td>
    </tr>
    <tr>
        <td>Авторизация</td>
        <td>14 * 16Кбайт / 2^20 = 0,0002</td>
        <td>Сетевой трафик одного запроса - 16Кбайт, тогда 800тыс * 16Кбайт / 2^20 = 12,2</td>
        <td>Всего 24млн месячных пользователей, среднестатистический пользователь заходит в музыку 21 день из 30, авторизационный токен необходимо обновлять 1 раз в месяц, тогда средний рпс = 24млн / 30 / 86400 = 9,3</td>
        <td>Пиковый рпс на авторизацию = 14</td>
    </tr>
    <tr>
        <td>Регистрация</td>
        <td>0,20 * 16Кбайт / 2^20 = 0,0000032</td>
        <td>Всего 12 000 * 16Кбайт / 2^20 = 0,18</td>
        <td>Месячный рост новых пользователей составляет около 1,5%, тогда в месяц новых пользователей 24млн * 0,015 = 360 000, в день получается 12 000 новых пользователей, тогда средний рпс будет = 12 000 / 86400 = 0,14</td>
        <td>Пик рпс = 0,20</td>
    </tr>
    <tr>
        <td>Добавление/удаление треков в/из плейлист</td>
        <td>Пиковый rps = 30 * 1,2 Кбайт / 2^20 = 0,00003</td>
        <td>Размер одного запроса - 1,2Кбайт (информация из dev tools) => всего 1,554млн * 1,2Кбайт / 2^20 = 1,78</td>
        <td>Средний рпс = 1,554млн / 86400 = 18</td>
        <td>Пиковый рпс = 30</td>
    </tr>
    <tr>
        <td>Получение треков из истории</td>
        <td>334 * 15,5Кбайт / 2^20 = 0,005</td>
        <td>14,4млн * 1 * 15,5Кбайт (информация из dev tools) / 2^20 = 213</td>
        <td>rps = 14,4млн * 1 / 86400 = 167</td>
        <td>Пиковый rps = 167 * 2 = 334</td>
    </tr>
    <tr>
        <td>Поиск исполнителя, трека, альбома</td>
        <td>1000 * 15Кбайт / 2^20 = 0,014</td>
        <td>57,6млн * 15Кбайт (информация из dev tools) / 2^20 = 824</td>
        <td>rps = 57,6млн / 86400 = 667</td>
        <td>Пиковый rps = 667 * 1,5 = 1000</td>
    </tr>
    <tr>
        <td>Поиск треков по жанру</td>
        <td>2,5 * 210Кбайт / 2^20 = 0,0005</td>
        <td>140тыс * 210Кбайт (информация из dev tools) / 2^20 = 28</td>
        <td>rps = 140тыс / 86400 = 1,62</td>
        <td>Пиковый rps = 2,5</td>
    </tr>
    <tr>
        <td>Прослушивание подкастов</td>
        <td>6300 * 128Кбит/с / 2^20 = 0,77</td>
        <td>1,008млн * 45мин * 60 * 128Кбит/c / 2^20 = 332 226</td>
        <td>rps = 1,008млн * 45мин(средняя длительность прослушивания подкастов) * 6 / 86400 = 3150</td>
        <td>Пиковый рпс = 3150 * 2 = 6300</td>
    </tr>
</table>

### Список используемых источников
1. [https://yandex.ru/company/news/03-21-08-2024](https://yandex.ru/company/news/03-21-08-2024)
2. [https://vc.ru/media/187539-auditoriya-podkastov-na-yandeksmuzyke-vyrosla-v-chetyre-raza-za-god-hotya-by-raz-v-mesyac-ih-slushayut-uzhe-28-podpischikov](https://vc.ru/media/187539-auditoriya-podkastov-na-yandeksmuzyke-vyrosla-v-chetyre-raza-za-god-hotya-by-raz-v-mesyac-ih-slushayut-uzhe-28-podpischikov)
3. [https://www.amplifier.ru/news/2024/06/12/yandeks-muzyka-110624.html#:~:text=Пользователям%20будут%20доступны%20три%20опции,без%20потерь%20в%20формате%20Lossless.](https://www.amplifier.ru/news/2024/06/12/yandeks-muzyka-110624.html#:~:text=Пользователям%20будут%20доступны%20три%20опции,без%20потерь%20в%20формате%20Lossless.)
4. [https://yandex.ru/company/researches/2021/podcasts#:~:text=В%20каталоге%20Яндекс.Музыки%2011,запускалось%20более%20500%20новых%20проектов.](https://yandex.ru/company/researches/2021/podcasts#:~:text=В%20каталоге%20Яндекс.Музыки%2011,запускалось%20более%20500%20новых%20проектов.)
5. [https://ru.wikipedia.org/wiki/Яндекс_Музыка#:~:text=По%20состоянию%20на%202023%20год,пользуется%20около%2020%20млн%20человек.](https://ru.wikipedia.org/wiki/Яндекс_Музыка#:~:text=По%20состоянию%20на%202023%20год,пользуется%20около%2020%20млн%20человек.)
